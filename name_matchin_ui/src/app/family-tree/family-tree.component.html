<div class="modal-header">
  <h2 mat-dialog-title>Family Tree Results for {{ data.identity.first_name }}</h2>
  <button mat-icon-button (click)="close()" aria-label="Close">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content class="modal-content" [class.is-scrollable]="familyGraphs.length > 1">
  <div *ngIf="isLoading" class="loading-indicator">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ !imageUrl ? 'Loading family graphsâ€¦' : 'Generating image...' }}</p>
  </div>

  <div *ngIf="!isLoading && error" class="error-message">
    <mat-icon color="warn">warning</mat-icon>
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!isLoading && !error" class="graphs-wrapper">
    <div *ngFor="let graph of familyGraphs; let i = index" class="graph-container">
      <h3 class="graph-title">Candidate Match: {{ graph.candidate.name }} (Family: {{ graph.candidate.family }})</h3>
      <div #vizContainer class="network-canvas"></div>
    </div>

    <div *ngIf="imageUrl" class="image-container">
      <h3 class="image-title">Generated Family Tree Image</h3>
      <img [src]="imageUrl" alt="Generated Family Tree">
    </div>

    <div *ngIf="rawJsonForDisplay" class="json-container">
      <details>
        <summary class="json-title">View Raw Neo4j JSON Data</summary>
        <pre><code>{{ rawJsonForDisplay }}</code></pre>
      </details>
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button
    mat-flat-button
    color="primary"
    (click)="generateImage()"
    [disabled]="isLoading || familyGraphs.length === 0">
    Generate Image
  </button>
  <button mat-stroked-button (click)="close()">Close</button>
</mat-dialog-actions>
